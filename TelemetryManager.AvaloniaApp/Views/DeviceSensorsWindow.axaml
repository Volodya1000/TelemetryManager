<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:TelemetryManager.AvaloniaApp.ViewModels"
        x:Class="TelemetryManager.AvaloniaApp.Views.DeviceSensorsWindow"
        x:DataType="vm:DeviceSensorsViewModel"
        Title="{Binding DeviceHeader}">

  <StackPanel Margin="20" Spacing="10">
    <TextBlock Text="{Binding DeviceHeader}" FontSize="16"/>

    <!-- Блок ошибок -->
    <TextBlock Text="{Binding ErrorMessage}"
               Foreground="Red"
               TextWrapping="Wrap"
               MaxWidth="400"/>

    <!-- Форма добавления сенсора -->
    <Grid ColumnDefinitions="*,2*" RowDefinitions="Auto,Auto,Auto" RowSpacing="5">
      <!-- Тип сенсора -->
      <TextBlock Grid.Row="0" Grid.Column="0"
                 Text="Тип сенсора:"
                 VerticalAlignment="Center"/>
      <ComboBox Grid.Row="0" Grid.Column="1"
                ItemsSource="{Binding AvailableSensorTypes}"
                SelectedItem="{Binding SelectedSensorType}">
        <ComboBox.ItemTemplate>
          <DataTemplate>
            <TextBlock Text="{Binding Name.Value}"/>
          </DataTemplate>
        </ComboBox.ItemTemplate>
      </ComboBox>

      <!-- Source ID -->
      <TextBlock Grid.Row="1" Grid.Column="0"
                 Text="Source ID:"
                 VerticalAlignment="Center"/>
      <NumericUpDown Grid.Row="1" Grid.Column="1"
                     Value="{Binding SourceId}"
                     Minimum="0"
                     Maximum="255"
                     Watermark="0-255"/>

      <!-- Кнопка добавления -->
      <Button Grid.Row="2" Grid.Column="1"
              Content="Добавить сенсор"
              Command="{Binding AddSensorCommand}"
              HorizontalAlignment="Right"
              Padding="10 5"/>
    </Grid>

    <Border BorderBrush="#DDD" BorderThickness="1">
      <!-- Шапка таблицы -->
      <Grid ColumnDefinitions="Auto,Auto,*,Auto,Auto">
        <!-- Добавлен 5-й столбец -->
        <TextBlock Grid.Column="0" Text="TypeID" FontWeight="Bold" Margin="5"/>
        <TextBlock Grid.Column="1" Text="SourceID" FontWeight="Bold" Margin="5"/>
        <TextBlock Grid.Column="2" Text="Название" FontWeight="Bold" Margin="5"/>
        <TextBlock Grid.Column="3" Text="Количество параметров" FontWeight="Bold" Margin="5"/>
        <TextBlock Grid.Column="4" Text="Включён" FontWeight="Bold" Margin="5"/>
      </Grid>
    </Border>

    <!-- Список датчиков -->
    <ListBox ItemsSource="{Binding Sensors}"
         BorderThickness="0"
         Padding="0">
      <ListBox.ItemTemplate>
        <DataTemplate>
          <Expander>
            <Expander.Header>
              <Grid ColumnDefinitions="Auto,Auto,*,Auto,Auto">
                <TextBlock Grid.Column="0" Text="{Binding TypeId}" Margin="5"/>
                <TextBlock Grid.Column="1" Text="{Binding SourceId}" Margin="5"/>
                <TextBlock Grid.Column="2" Text="{Binding Name}" Margin="5"/>
                <TextBlock Grid.Column="3" Text="{Binding Parameters.Count}" Margin="5"/>
                <CheckBox Grid.Column="4"
                          IsChecked="{Binding IsConnected, Mode=TwoWay}"
                          VerticalAlignment="Center"
                          HorizontalAlignment="Center"
                          Margin="5"/>
              </Grid>
            </Expander.Header>

            <ItemsControl ItemsSource="{Binding Parameters}" Margin="20,5">
              <ItemsControl.ItemTemplate>
                <DataTemplate>
                  <Grid ColumnDefinitions="*,*" Margin="0,2">
                    <TextBlock Grid.Column="0"
                               Text="{Binding Name}"
                               FontWeight="Bold"/>
                    <TextBlock Grid.Column="1"
                               Text="{Binding IntervalDisplay}"
                               Margin="10,0,0,0"/>
                  </Grid>
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>
          </Expander>
        </DataTemplate>
      </ListBox.ItemTemplate>
    </ListBox>
  </StackPanel>
</Window>